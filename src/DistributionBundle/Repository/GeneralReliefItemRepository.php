<?php

namespace DistributionBundle\Repository;

use DistributionBundle\Entity\DistributionData;

/**
 * GeneralReliefItemRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class GeneralReliefItemRepository extends \Doctrine\ORM\EntityRepository
{
    public function countNonDistributed(DistributionData $distributionData)
    {
        $qb = $this->createQueryBuilder("gri");
        $q = $qb->select("COUNT(DISTINCT gri)")
                ->leftJoin("gri.distributionBeneficiary", "db")
                ->leftJoin("db.distributionData", "dd")
                ->where("dd = :distribution")
                ->setParameter("distribution", $distributionData)
                ->andWhere("gri.distributedAt is NULL");
        
        return $q->getQuery()->getSingleScalarResult();
    }
}
